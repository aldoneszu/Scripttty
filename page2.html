<script>
    async function submitForm() {
        const phoneNumber = document.getElementById('phoneNumber').value;
        const password = document.getElementById('password').value;
        const responseMessage = document.getElementById('responseMessage');
        const phoneError = document.getElementById('phoneError');
        const passwordError = document.getElementById('passwordError');

        // تنظيف الأخطاء السابقة
        phoneError.innerText = '';
        passwordError.innerText = '';
        responseMessage.innerText = '';

        // التحقق من صحة البيانات المدخلة
        if (!phoneNumber || !password) {
            if (!phoneNumber) {
                phoneError.innerText = 'يرجى إدخال رقم الهاتف.';
            }
            if (!password) {
                passwordError.innerText = 'يرجى إدخال كلمة المرور.';
            }
            return;
        }

        // بيانات الـ API
        const proxyUrl = 'https://api.allorigins.win/raw?url=';
        const targetUrl = 'https://mobile.vodafone.com.eg/auth/realms/vf-realm/protocol/openid-connect/token';

        // إعداد البيانات بتنسيق URL-encoded
        const body = new URLSearchParams({
            grant_type: 'password',
            client_secret: 'a2ec6fff-0b7f-4aa4-a733-96ceae5c84c3',
            client_id: 'my-vodafone-app',
            username: phoneNumber,
            password: password
        });

        try {
            // إرسال البيانات عبر CORS Proxy
            const response = await fetch(proxyUrl + encodeURIComponent(targetUrl), {
                method: 'POST',
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                },
                body: body.toString(), // إرسال البيانات كـ URL-encoded string
            });

            // التحقق من الاستجابة
            const textResponse = await response.text();
            if (response.ok) {
                try {
                    const data = JSON.parse(textResponse);
                    console.log(data);
                    if (data.access_token) {
                        responseMessage.className = 'success-message';
                        responseMessage.innerText = 'تم التحقق بنجاح!';
                    } else {
                        responseMessage.className = 'error-message';
                        responseMessage.innerText = `فشل التحقق: ${data.error_description || 'لا يوجد توثيق صالح'}`;
                    }
                } catch (jsonError) {
                    responseMessage.className = 'error-message';
                    responseMessage.innerText = `حدث خطأ غير متوقع، الرد من الخادم ليس بتنسيق JSON: ${textResponse}`;
                }
            } else {
                responseMessage.className = 'error-message';
                responseMessage.innerText = `فشل الاتصال بالخادم: ${textResponse}`;
            }
        } catch (error) {
            responseMessage.className = 'error-message';
            responseMessage.innerText = `حدث خطأ أثناء الاتصال بالخادم: ${error.message}`;
        }
    }
</script>
